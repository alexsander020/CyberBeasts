(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class b{constructor(){this.canvas=document.getElementById("wheel-canvas"),this.overlay=document.getElementById("wheel-overlay"),this.container=document.getElementById("wheel-container"),this.resultText=document.getElementById("wheel-result"),this.battleLog=document.getElementById("battle-log"),this.atAvatar=document.getElementById("attacker-avatar"),this.atName=document.getElementById("attacker-name-label"),this.dfAvatar=document.getElementById("defender-avatar"),this.dfName=document.getElementById("defender-name-label"),this.colors={blue:"#0088ff",gold:"#ffcc00",purple:"#ff00ff",white:"#ffffff",red:"#ff3333"}}static getPriority(t){return{blue:10,gold:5,purple:3,white:1,red:0}[t]||0}static resolveCombat(t,e,s,i){const n=this.getPriority(s.type),r=this.getPriority(i.type);return s.type==="blue"&&i.type!=="blue"?"attacker_defends":i.type==="blue"&&s.type!=="blue"?"defender_defends":s.type==="blue"&&i.type==="blue"?"draw":n>r?"attacker_wins":r>n?"defender_wins":s.type==="white"?s.power>i.power?"attacker_wins":i.power>s.power?"defender_wins":"draw":s.type==="purple"?s.stars>i.stars?"attacker_wins":i.stars>s.stars?"defender_wins":"draw":"draw"}async fullBattle(t,e){this.overlay.style.display="flex",this.resultText.innerText="",this.battleLog.innerText="INITIALIZING COMBAT PROTOCOL...",this.atAvatar.innerText=t.icon,this.atName.innerText=t.name,this.dfAvatar.innerText=e.icon,this.dfName.innerText=e.name,this.battleLog.innerText=`> ATTACKER SPINNING: ${t.name}`;const s=await this.spinOnce(t);this.battleLog.innerText=`> ATTACKER RESULT: ${s.label.toUpperCase()}`,await new Promise(r=>setTimeout(r,1e3)),this.battleLog.innerText=`> DEFENDER SPINNING: ${e.name}`;const i=await this.spinOnce(e);this.battleLog.innerText=`> DEFENDER RESULT: ${i.label.toUpperCase()}`,await new Promise(r=>setTimeout(r,1e3));const n=b.resolveCombat(t,e,s,i);return this.animateResolution(n),await new Promise(r=>setTimeout(r,2e3)),this.overlay.style.display="none",n}async spinOnce(t){return new Promise(e=>{this.draw(t.wheel),this.container.style.transition="transform 3.0s cubic-bezier(0.15, 0, 0.15, 1)";const s=1440+Math.floor(Math.random()*360);this.container.style.transform=`rotate(${s}deg)`,setTimeout(()=>{const n=(360-(s%360-90))%360,r=this.calculateResult(t.wheel,n);this.resultText.innerText=r.label.toUpperCase(),this.resultText.style.color=this.colors[r.type],this.resultText.classList.add("active"),this.container.classList.add("combat-impact"),setTimeout(()=>{this.container.style.transition="none",this.container.style.transform="rotate(0deg)",this.resultText.classList.remove("active"),this.container.classList.remove("combat-impact"),e(r)},1e3)},3100)})}animateResolution(t){let e="DRAW / PARITY";t==="attacker_wins"&&(e="!!!! ATTACKER WIN !!!!"),t==="defender_wins"&&(e="!!!! DEFENDER WIN !!!!"),(t==="attacker_defends"||t==="defender_defends")&&(e="PROTOCOL: DEFENSE"),this.battleLog.innerText=`[ ${e} ]`,this.resultText.innerText=e,this.resultText.style.color="#fff",this.resultText.classList.add("active")}draw(t){const e=this.canvas.getContext("2d");e.clearRect(0,0,280,280);let s=0;const i=96,n=140,r=140,c=135;t.forEach(a=>{const d=a.size/i*2*Math.PI;e.beginPath(),e.moveTo(n,r),e.arc(n,r,c,s,s+d),e.fillStyle=this.colors[a.type],e.fill(),e.strokeStyle="rgba(0,0,0,0.5)",e.lineWidth=1,e.stroke(),e.save(),e.translate(n,r),e.rotate(s+d/2),e.textAlign="right",e.fillStyle=a.type==="white"||a.type==="gold"?"#000":"#fff",e.font="bold 10px 'JetBrains Mono'";const o=a.label.toUpperCase(),u=a.power?`[${a.power}]`:a.stars?"â­".repeat(a.stars):"";e.fillText(o,c-15,0),u&&(e.font="8px 'JetBrains Mono'",e.fillText(u,c-15,12)),e.restore(),s+=d})}calculateResult(t,e){let s=0;const i=e/360*96;for(const n of t){if(i>=s&&i<s+n.size)return n;s+=n.size}return t[t.length-1]}}class x{constructor(t){this.gameState=t,this.container=document.getElementById("nodes-layer"),this.svg=document.getElementById("board-svg"),this.unitsLayer=document.getElementById("units-layer"),this.nodes=[],this.connections=[],this.units=new Map,this.wheel=null,this.selectedUnit=null,this.validMoveMap=null,this.init()}setWheel(t){this.wheel=t}init(){this.nodes=[{id:0,x:30,y:90,type:"entry",team:"player"},{id:1,x:70,y:90,type:"entry",team:"player"},{id:2,x:50,y:95,type:"core",team:"player"},{id:3,x:10,y:50,type:"node"},{id:4,x:30,y:50,type:"node"},{id:5,x:50,y:50,type:"node"},{id:6,x:70,y:50,type:"node"},{id:7,x:90,y:50,type:"node"},{id:8,x:30,y:10,type:"entry",team:"enemy"},{id:9,x:70,y:10,type:"entry",team:"enemy"},{id:10,x:50,y:5,type:"core",team:"enemy"}],this.connections=[[0,3],[0,4],[1,6],[1,7],[3,4],[4,5],[5,6],[6,7],[8,3],[8,4],[9,6],[9,7],[4,10],[5,10],[6,10],[2,4],[2,5],[2,6]],this.render()}render(){!this.container||!this.svg||(this.container.innerHTML="",this.svg.innerHTML="",this.connections.forEach(([t,e])=>{const s=this.nodes[t],i=this.nodes[e],n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1",`${s.x}%`),n.setAttribute("y1",`${s.y}%`),n.setAttribute("x2",`${i.x}%`),n.setAttribute("y2",`${i.y}%`),n.setAttribute("stroke","rgba(0, 242, 255, 0.3)"),n.setAttribute("stroke-width","2"),this.svg.appendChild(n)}),this.nodes.forEach(t=>{const e=document.createElement("div");e.className=`grid-point ${t.type}`,e.style.left=`${t.x}%`,e.style.top=`${t.y}%`,e.dataset.id=t.id,t.type==="core"&&(e.style.boxShadow="0 0 15px #FF0055"),e.addEventListener("click",()=>this.onNodeClick(t)),this.container.appendChild(e)}))}async onNodeClick(t){console.log(`Node ${t.id} clicked. Unit there:`,this.units.get(t.id));const e=this.units.get(t.id),s=document.getElementById("status-panel");if(e&&e.owner===this.gameState.currentPlayer){this.selectedUnit=e,this.showValidMoves(t.id,e.mp),s.innerHTML=`> UNIDADE SELECIONADA: ${e.name}<br>> MP DISPONÃVEL: ${e.mp}`;return}if(this.selectedUnit){const i=this.getPath(this.selectedUnit.currentNode,t.id);if(i){const n=this.selectedUnit;this.selectedUnit=null,this.clearHighlights(),await this.animateMove(n,i);return}}this.selectedUnit=null,this.clearHighlights(),s.innerHTML=`> NODO SELECIONADO: ${t.id}`}showValidMoves(t,e){this.clearHighlights(),this.validMoveMap=this.getReachableNodesMap(t,e);for(const[s,i]of this.validMoveMap.entries()){const n=document.querySelector(`.grid-point[data-id="${s}"]`);if(n){const r=this.units.has(s)&&this.units.get(s).owner!==this.gameState.currentPlayer;n.style.boxShadow=r?"0 0 15px #ff3333":"0 0 20px #00ffcc",n.classList.add("valid-move")}}}getReachableNodesMap(t,e){const s=new Map,i=[{id:t,dist:0,path:[]}],n=new Set([t]);for(;i.length>0;){const{id:r,dist:c,path:a}=i.shift();c>0&&s.set(r,a),c<e&&this.getNeighbors(r).forEach(o=>{const u=this.units.get(o),p=u&&u.owner!==this.gameState.currentPlayer;n.has(o)||(p?(s.set(o,[...a,o]),n.add(o)):u||(n.add(o),i.push({id:o,dist:c+1,path:[...a,o]})))})}return s}getPath(t,e){return this.validMoveMap?this.validMoveMap.get(e):null}async animateMove(t,e){const s=t.currentNode;this.units.delete(s);for(let n=0;n<e.length;n++){const r=e[n],c=n===e.length-1,a=this.units.get(r);if(a&&a.owner!==t.owner&&c){const d=await this.startCombat(t,a);if(d==="attacker_wins")this.deleteUnit(r),this.placeUnit(t,r);else if(d==="defender_wins"){this.deleteUnit(t.currentNode);return}break}else this.placeUnit(t,r),await new Promise(d=>setTimeout(d,200))}const i=this.nodes[t.currentNode];i.type==="core"&&i.team!==t.owner&&(alert(`SISTEMA INVADIDO! ${t.owner.toUpperCase()} VENCEU!`),location.reload()),this.checkSurround(t.currentNode)}async startCombat(t,e){const s=await this.wheel.fullBattle(t,e);return console.log(`Combat Resolution: ${s}`),s}getNeighbors(t){return this.connections.filter(e=>e.includes(t)).map(e=>e[0]===t?e[1]:e[0])}clearHighlights(){this.nodes.forEach(t=>{const e=document.querySelector(`.grid-point[data-id="${t.id}"]`);e&&(e.style.boxShadow=t.type==="core"?"0 0 15px #FF0055":"0 0 8px var(--cyan-neon)",e.classList.remove("valid-move"))})}placeUnit(t,e){const s=this.nodes[e];t.currentNode=e,this.units.set(e,t);let i=document.getElementById(`unit-${t.uuid}`);i||(i=document.createElement("div"),i.id=`unit-${t.uuid}`,i.className=`unit-disc ${t.owner}`,i.innerHTML=`<div class="base" style="border-color: ${t.color}"></div><div class="visual">${t.icon}</div>`,this.unitsLayer.appendChild(i)),i.style.left=`${s.x}%`,i.style.top=`${s.y}%`}checkSurround(t){const e=this.units.get(t);if(!e)return;const s=this.getNeighbors(t);s.every(n=>{const r=this.units.get(n);return r&&r.owner!==e.owner})&&s.length>0&&this.deleteUnit(t)}deleteUnit(t){const e=this.units.get(t);if(e){const s=document.getElementById(`unit-${e.uuid}`);s?(s.classList.add("deleting"),setTimeout(()=>{s.remove(),this.units.delete(t),this.gameState.moveToDataCenter(e)},600)):(this.units.delete(t),this.gameState.moveToDataCenter(e))}}}class N{constructor(){this.playerBench=[],this.enemyBench=[],this.dataCenter=[],this.currentPlayer="player",this.turnNumber=1,this.plates=[{id:"p1",name:"Overclock",desc:"+1 MP temporarily",effect:"mp_boost"},{id:"p2",name:"Data Repair",desc:"Resets a unit to bench",effect:"recall"},{id:"p3",name:"Firewall",desc:"Blocks a node for 1 turn",effect:"block"}]}addToBench(t,e){e==="player"?this.playerBench.push(t):this.enemyBench.push(t),this.triggerBenchEvent()}moveToDataCenter(t){if(t.status="deleted",this.dataCenter.push(t),this.updateDataCenterUI(),this.dataCenter.length>2){const e=this.dataCenter.shift();this.rebootUnit(e)}}rebootUnit(t){console.log(`REBOOTING: ${t.name}`),this.addToBench(t,t.owner),this.updateDataCenterUI()}updateDataCenterUI(){for(let t=0;t<2;t++){const e=document.getElementById(`dc-${t}`);if(e){const s=this.dataCenter[t];s?(e.classList.add("occupied"),e.innerHTML=s.icon||"ðŸ‘¾",e.title=s.name,e.style.borderColor=s.color||"var(--cyber-pink)"):(e.classList.remove("occupied"),e.innerHTML="",e.title="",e.style.borderColor="")}}}triggerBenchEvent(){const t=new CustomEvent("benchUpdated",{detail:{state:this}});document.dispatchEvent(t)}nextTurn(){this.currentPlayer=this.currentPlayer==="player"?"enemy":"player",this.turnNumber++,this.showTurnSplash(),this.updateUI()}showTurnSplash(){const t=document.getElementById("turn-splash"),e=document.getElementById("splash-text");!t||!e||(e.innerText=this.currentPlayer==="player"?"YOUR TURN":"AI TURN",e.style.color=this.currentPlayer==="player"?"var(--cyan-neon)":"var(--cyber-pink)",e.style.textShadow=`0 0 20px ${e.style.color}`,t.style.display="flex",setTimeout(()=>{t.style.display="none"},1200))}updateUI(){const t=document.getElementById("turn-val");t&&(t.innerText=this.turnNumber);const e=document.getElementById("status-panel");e&&(e.innerHTML=`> TURNO: ${this.turnNumber}<br>> ARQUITETADOR: ${this.currentPlayer.toUpperCase()}`)}}class g{constructor(t,e){this.uuid=t||`cb-${Math.random().toString(36).substr(2,9)}`,this.name=e.name,this.type=e.type||"Standard",this.rarity=e.rarity||"Common",this.mp=e.mp||2,this.icon=e.icon||"ðŸ‘¾",this.color=e.color||"#fff",this.wheel=e.wheel||[],this.hp=1,this.owner=e.owner||"player",this.currentNode=null}static fromJSON(t,e){return new g(t.uuid,{...t,owner:e})}}const M=[{name:"Megabit Dragon",type:"Striker",rarity:"EX",mp:2,icon:"ðŸ§§",color:"#ff3333",wheel:[{type:"white",label:"Data Claw",size:40,power:120},{type:"purple",label:"System Crash",size:24,stars:3},{type:"blue",label:"Protect",size:12},{type:"red",label:"Miss",size:20}]},{name:"Tank-Shell",type:"Tank",rarity:"R",mp:1,icon:"ðŸ§±",color:"#0088ff",wheel:[{type:"white",label:"Heavy Slam",size:50,power:140},{type:"blue",label:"Hard Shield",size:30},{type:"red",label:"Miss",size:16}]},{name:"Cyber-Scout",type:"Speedster",rarity:"UC",mp:3,icon:"ðŸ¹",color:"#00ffcc",wheel:[{type:"gold",label:"Quick Jab",size:30,power:40},{type:"white",label:"Dagger",size:30,power:60},{type:"red",label:"Miss",size:36}]}];class C{constructor(t,e){this.grid=t,this.gameState=e}async playTurn(){console.log("AI starts processing data...");const t=Array.from(this.grid.units.values()).filter(n=>n.owner==="player"),e=10;t.some(n=>this.grid.getNeighbors(e).includes(n.currentNode))&&this.gameState.enemyBench.length>0&&await this.trySpawn();const i=Array.from(this.grid.units.values()).filter(n=>n.owner==="enemy");for(const n of i)await this.calculateAggressiveMove(n),await new Promise(r=>setTimeout(r,600));await this.trySpawn()}async trySpawn(){if(this.gameState.enemyBench.length>0){const t=[8,9].filter(e=>!this.grid.units.has(e));if(t.length>0){const e=this.gameState.enemyBench.shift();this.grid.placeUnit(e,t[0]),console.log(`AI compiled ${e.name} at node ${t[0]}`),await new Promise(s=>setTimeout(s,800))}}}async calculateAggressiveMove(t){const e=this.grid.getReachableNodesMap(t.currentNode,t.mp),s=Array.from(e.keys());if(s.length===0)return;const i=10;if(s.includes(i)){await this.grid.animateMove(t,e.get(i));return}const n=s.filter(o=>{const u=this.grid.units.get(o);return u&&u.owner==="player"});if(n.length>0){const o=n[Math.floor(Math.random()*n.length)];await this.grid.animateMove(t,e.get(o));return}const r=2;let c=s[0],a=1/0;const d=this.grid.nodes[r];s.forEach(o=>{const u=this.grid.nodes[o],p=Math.sqrt(Math.pow(u.x-d.x,2)+Math.pow(u.y-d.y,2));p<a&&(a=p,c=o)}),await this.grid.animateMove(t,e.get(c))}}document.addEventListener("DOMContentLoaded",()=>{console.log("CyberBeasts: Kernel v2.8 Initialized");const l=new N,t=new x(l),e=new b;t.setWheel(e);const s=new C(t,l);M.forEach(h=>{l.addToBench(g.fromJSON(h,"player"),"player"),l.addToBench(g.fromJSON(h,"enemy"),"enemy")}),p(l),l.updateUI();const i=document.getElementById("btn-music"),n=document.getElementById("bg-music");i&&n&&(i.onclick=()=>{n.paused?(n.play(),i.innerText="â¸ï¸"):(n.pause(),i.innerText="ðŸŽµ")}),document.addEventListener("benchUpdated",h=>p(h.detail.state));const r=document.getElementById("btn-next-turn");r&&r.addEventListener("click",async h=>{h.stopPropagation(),l.currentPlayer==="player"&&(l.nextTurn(),l.currentPlayer==="enemy"&&setTimeout(async()=>{await s.playTurn(),l.nextTurn()},1e3))});const c=document.getElementById("btn-plates"),a=document.getElementById("plates-modal"),d=document.getElementById("plates-list"),o=document.getElementById("btn-close-plates");c&&(c.onclick=()=>{a.style.display="flex",u(l)}),o&&(o.onclick=()=>{a.style.display="none"}),a.onclick=h=>{h.target===a&&(a.style.display="none")};function u(h){d.innerHTML="",h.plates.forEach(m=>{const y=document.createElement("div");y.className="plate-card",y.innerHTML=`
                <div class="plate-name">${m.name.toUpperCase()}</div>
                <div class="plate-desc">${m.desc}</div>
            `,y.onclick=()=>{console.log(`Using Plate: ${m.name}`),a.style.display="none"},d.appendChild(y)})}function p(h){const m=document.getElementById("bench-slots");m&&(m.innerHTML="",h.playerBench.forEach((y,v)=>{const f=document.createElement("div");f.className="bench-slot",f.innerHTML=y.icon,f.style.borderColor=y.color,f.title=`${y.name} (${y.type})`,f.onclick=T=>{if(T.stopPropagation(),h.currentPlayer!=="player")return;const w=[0,1].filter(E=>!t.units.has(E));w.length>0?(t.placeUnit(y,w[0]),h.playerBench.splice(v,1),p(h)):alert("PROTOCOL ERROR: Portal de Entrada bloqueado!")},m.appendChild(f)}))}});
