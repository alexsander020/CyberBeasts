(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();class w{constructor(){this.canvas=document.getElementById("wheel-canvas"),this.overlay=document.getElementById("wheel-overlay"),this.container=document.getElementById("wheel-container"),this.resultText=document.getElementById("wheel-result"),this.colors={blue:"#0088ff",gold:"#ffcc00",purple:"#ff00ff",white:"#ffffff",red:"#ff3333"}}static resolveCombat(e,t,i,s){const n=this.getPriority(i.type),r=this.getPriority(s.type);return i.type==="blue"&&s.type!=="blue"?"attacker_defends":s.type==="blue"&&i.type!=="blue"?"defender_defends":i.type==="blue"&&s.type==="blue"?"draw":n>r?"attacker_wins":r>n?"defender_wins":i.type==="white"?i.power>s.power?"attacker_wins":"defender_wins":i.type==="purple"?i.stars>s.stars?"attacker_wins":"defender_wins":"draw"}static getPriority(e){return{blue:10,gold:5,purple:3,white:1,red:0}[e]||0}async spin(e){return new Promise(t=>{this.overlay.style.display="flex",this.draw(e.wheel);const i=1440+Math.floor(Math.random()*360);this.container.style.transform=`rotate(${i}deg)`,setTimeout(()=>{const n=(360-(i%360-90))%360,r=this.calculateResult(e.wheel,n);this.resultText.innerText=`${r.label.toUpperCase()} (${r.type.toUpperCase()})`,this.resultText.classList.add("active"),this.container.classList.add("combat-impact"),setTimeout(()=>{this.overlay.style.display="none",this.container.style.transform="rotate(0deg)",this.resultText.classList.remove("active"),this.container.classList.remove("combat-impact"),t(r)},1500)},3200)})}draw(e){const t=this.canvas.getContext("2d");t.clearRect(0,0,250,250);let i=0;const s=96;e.forEach(n=>{const r=n.size/s*2*Math.PI;t.beginPath(),t.moveTo(125,125),t.arc(125,125,120,i,i+r),t.fillStyle=this.colors[n.type],t.fill(),t.stroke(),i+=r})}calculateResult(e,t){let i=0;const s=t/360*96;for(const n of e){if(s>=i&&s<i+n.size)return n;i+=n.size}return e[e.length-1]}}class v{constructor(e){this.gameState=e,this.container=document.getElementById("nodes-layer"),this.svg=document.getElementById("board-svg"),this.unitsLayer=document.getElementById("units-layer"),this.nodes=[],this.connections=[],this.units=new Map,this.wheel=null,this.selectedUnit=null,this.validMoveMap=null,this.init()}setWheel(e){this.wheel=e}init(){this.nodes=[{id:0,x:30,y:90,type:"entry",team:"player"},{id:1,x:70,y:90,type:"entry",team:"player"},{id:2,x:50,y:95,type:"core",team:"player"},{id:3,x:10,y:50,type:"node"},{id:4,x:30,y:50,type:"node"},{id:5,x:50,y:50,type:"node"},{id:6,x:70,y:50,type:"node"},{id:7,x:90,y:50,type:"node"},{id:8,x:30,y:10,type:"entry",team:"enemy"},{id:9,x:70,y:10,type:"entry",team:"enemy"},{id:10,x:50,y:5,type:"core",team:"enemy"}],this.connections=[[0,3],[0,4],[1,6],[1,7],[3,4],[4,5],[5,6],[6,7],[8,3],[8,4],[9,6],[9,7],[4,10],[5,10],[6,10],[2,4],[2,5],[2,6]],this.render()}render(){!this.container||!this.svg||(this.container.innerHTML="",this.svg.innerHTML="",this.connections.forEach(([e,t])=>{const i=this.nodes[e],s=this.nodes[t],n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1",`${i.x}%`),n.setAttribute("y1",`${i.y}%`),n.setAttribute("x2",`${s.x}%`),n.setAttribute("y2",`${s.y}%`),n.setAttribute("stroke","rgba(0, 242, 255, 0.3)"),n.setAttribute("stroke-width","2"),this.svg.appendChild(n)}),this.nodes.forEach(e=>{const t=document.createElement("div");t.className=`grid-point ${e.type}`,t.style.left=`${e.x}%`,t.style.top=`${e.y}%`,t.dataset.id=e.id,e.type==="core"&&(t.style.boxShadow="0 0 15px #FF0055"),t.addEventListener("click",()=>this.onNodeClick(e)),this.container.appendChild(t)}))}async onNodeClick(e){console.log(`Node ${e.id} clicked. Unit there:`,this.units.get(e.id));const t=this.units.get(e.id),i=document.getElementById("status-panel");if(t&&t.owner===this.gameState.currentPlayer){this.selectedUnit=t,this.showValidMoves(e.id,t.mp),i.innerHTML=`> UNIDADE SELECIONADA: ${t.name}<br>> MP DISPONÃVEL: ${t.mp}`;return}if(this.selectedUnit){const s=this.getPath(this.selectedUnit.currentNode,e.id);if(s){const n=this.selectedUnit;this.selectedUnit=null,this.clearHighlights(),await this.animateMove(n,s);return}}this.selectedUnit=null,this.clearHighlights(),i.innerHTML=`> NODO SELECIONADO: ${e.id}`}showValidMoves(e,t){this.clearHighlights(),this.validMoveMap=this.getReachableNodesMap(e,t);for(const[i,s]of this.validMoveMap.entries()){const n=document.querySelector(`.grid-point[data-id="${i}"]`);if(n){const r=this.units.has(i)&&this.units.get(i).owner!==this.gameState.currentPlayer;n.style.boxShadow=r?"0 0 15px #ff3333":"0 0 20px #00ffcc",n.classList.add("valid-move")}}}getReachableNodesMap(e,t){const i=new Map,s=[{id:e,dist:0,path:[]}],n=new Set([e]);for(;s.length>0;){const{id:r,dist:h,path:a}=s.shift();h>0&&i.set(r,a),h<t&&this.getNeighbors(r).forEach(d=>{const u=this.units.get(d),o=u&&u.owner!==this.gameState.currentPlayer;n.has(d)||(o?(i.set(d,[...a,d]),n.add(d)):u||(n.add(d),s.push({id:d,dist:h+1,path:[...a,d]})))})}return i}getPath(e,t){return this.validMoveMap?this.validMoveMap.get(t):null}async animateMove(e,t){const i=e.currentNode;this.units.delete(i);for(let n=0;n<t.length;n++){const r=t[n],h=n===t.length-1,a=this.units.get(r);if(a&&a.owner!==e.owner&&h){const c=await this.startCombat(e,a);if(c==="attacker_wins")this.deleteUnit(r),this.placeUnit(e,r);else if(c==="defender_wins"){this.deleteUnit(e.currentNode);return}break}else this.placeUnit(e,r),await new Promise(c=>setTimeout(c,200))}const s=this.nodes[e.currentNode];s.type==="core"&&s.team!==e.owner&&(alert(`SISTEMA INVADIDO! ${e.owner.toUpperCase()} VENCEU!`),location.reload()),this.checkSurround(e.currentNode)}async startCombat(e,t){const i=await this.wheel.spin(e),s=await this.wheel.spin(t);return w.resolveCombat(e,t,i,s)}getNeighbors(e){return this.connections.filter(t=>t.includes(e)).map(t=>t[0]===e?t[1]:t[0])}clearHighlights(){this.nodes.forEach(e=>{const t=document.querySelector(`.grid-point[data-id="${e.id}"]`);t&&(t.style.boxShadow=e.type==="core"?"0 0 15px #FF0055":"0 0 8px var(--cyan-neon)",t.classList.remove("valid-move"))})}placeUnit(e,t){const i=this.nodes[t];e.currentNode=t,this.units.set(t,e);let s=document.getElementById(`unit-${e.uuid}`);s||(s=document.createElement("div"),s.id=`unit-${e.uuid}`,s.className=`unit-disc ${e.owner}`,s.innerHTML='<div class="base"></div><div class="visual">ðŸ‘¾</div>',this.unitsLayer.appendChild(s)),s.style.left=`${i.x}%`,s.style.top=`${i.y}%`}checkSurround(e){const t=this.units.get(e);if(!t)return;const i=this.getNeighbors(e);i.every(n=>{const r=this.units.get(n);return r&&r.owner!==t.owner})&&i.length>0&&this.deleteUnit(e)}deleteUnit(e){const t=this.units.get(e);if(t){const i=document.getElementById(`unit-${t.uuid}`);i?(i.classList.add("deleting"),setTimeout(()=>{i.remove(),this.units.delete(e),this.gameState.moveToDataCenter(t)},600)):(this.units.delete(e),this.gameState.moveToDataCenter(t))}}}class E{constructor(){this.playerBench=[],this.enemyBench=[],this.dataCenter=[],this.currentPlayer="player",this.turnNumber=1,this.plates=[{id:"p1",name:"Overclock",desc:"+1 MP temporarily",effect:"mp_boost"},{id:"p2",name:"Data Repair",desc:"Resets a unit to bench",effect:"recall"},{id:"p3",name:"Firewall",desc:"Blocks a node for 1 turn",effect:"block"}]}addToBench(e,t){t==="player"?this.playerBench.push(e):this.enemyBench.push(e),this.triggerBenchEvent()}moveToDataCenter(e){if(e.status="deleted",this.dataCenter.push(e),this.updateDataCenterUI(),this.dataCenter.length>2){const t=this.dataCenter.shift();this.rebootUnit(t)}}rebootUnit(e){console.log(`REBOOTING: ${e.name}`),this.addToBench(e,e.owner),this.updateDataCenterUI()}updateDataCenterUI(){for(let e=0;e<2;e++){const t=document.getElementById(`dc-${e}`);if(t){const i=this.dataCenter[e];i?(t.classList.add("occupied"),t.innerHTML="ðŸ‘¾",t.title=i.name):(t.classList.remove("occupied"),t.innerHTML="",t.title="")}}}triggerBenchEvent(){const e=new CustomEvent("benchUpdated",{detail:{state:this}});document.dispatchEvent(e)}nextTurn(){this.currentPlayer=this.currentPlayer==="player"?"enemy":"player",this.turnNumber++,this.updateUI()}updateUI(){const e=document.getElementById("turn-val");e&&(e.innerText=this.turnNumber);const t=document.getElementById("status-panel");t&&(t.innerHTML=`> TURNO: ${this.turnNumber}<br>> ARQUITETADOR: ${this.currentPlayer.toUpperCase()}`)}}class f{constructor(e,t){this.uuid=e||`cb-${Math.random().toString(36).substr(2,9)}`,this.name=t.name,this.rarity=t.rarity||"Common",this.mp=t.mp||2,this.wheel=t.wheel||[],this.hp=1,this.owner=t.owner||"player",this.currentNode=null}static fromJSON(e,t){return new f(e.uuid,{...e,owner:t})}}const M=[{name:"Megabit Dragon",rarity:"EX",mp:2,wheel:[{type:"white",label:"Data Claw",size:40,power:120},{type:"purple",label:"System Crash",size:24,stars:3},{type:"blue",label:"Protect",size:12},{type:"red",label:"Miss",size:20}]},{name:"Tank-Shell",rarity:"R",mp:1,wheel:[{type:"white",label:"Heavy Slam",size:50,power:140},{type:"blue",label:"Hard Shield",size:30},{type:"red",label:"Miss",size:16}]},{name:"Cyber-Scout",rarity:"UC",mp:3,wheel:[{type:"gold",label:"Quick Jab",size:30,power:40},{type:"white",label:"Dagger",size:30,power:60},{type:"red",label:"Miss",size:36}]}];class T{constructor(e,t){this.grid=e,this.gameState=t}async playTurn(){console.log("AI starts processing data...");const e=Array.from(this.grid.units.values()).filter(t=>t.owner==="enemy");await this.trySpawn();for(const t of e)await this.calculateAggressiveMove(t),await new Promise(i=>setTimeout(i,500))}async trySpawn(){if(this.gameState.enemyBench.length>0){const e=[8,9].filter(t=>!this.grid.units.has(t));if(e.length>0){const t=this.gameState.enemyBench.shift();this.grid.placeUnit(t,e[0]),console.log(`AI compiled ${t.name} at node ${e[0]}`),await new Promise(i=>setTimeout(i,800))}}}async calculateAggressiveMove(e){const t=this.grid.getReachableNodes(e.currentNode,e.mp);if(t.length===0)return;const i=2;if(t.includes(i)){await this.grid.executeMove(e,i);return}const s=t.filter(a=>{const c=this.grid.units.get(a);return c&&c.owner==="player"});if(s.length>0){const a=s[Math.floor(Math.random()*s.length)];await this.grid.executeMove(e,a);return}let n=t[0],r=1/0;const h=this.grid.nodes[i];t.forEach(a=>{const c=this.grid.nodes[a],d=Math.sqrt(Math.pow(c.x-h.x,2)+Math.pow(c.y-h.y,2));d<r&&(r=d,n=a)}),await this.grid.executeMove(e,n)}}document.addEventListener("DOMContentLoaded",()=>{console.log("CyberBeasts: Kernel v2.3 Initialized");const l=new E,e=new v(l),t=new w;e.setWheel(t);const i=new T(e,l);M.forEach(o=>{l.addToBench(f.fromJSON(o,"player"),"player"),l.addToBench(f.fromJSON(o,"enemy"),"enemy")}),u(l),l.updateUI();const s=document.getElementById("btn-music"),n=document.getElementById("bg-music");s&&n&&s.addEventListener("click",()=>{n.paused?(n.play(),s.classList.add("playing"),s.innerText="â¸ï¸"):(n.pause(),s.classList.remove("playing"),s.innerText="ðŸŽµ")}),document.addEventListener("benchUpdated",o=>u(o.detail.state));const r=document.getElementById("btn-next-turn");r&&r.addEventListener("click",async()=>{if(l.currentPlayer==="player"&&(l.nextTurn(),l.currentPlayer==="enemy")){const o=document.getElementById("status-panel");o.innerHTML+="<br>> PENSAMENTO DA IA ATIVO...",setTimeout(async()=>{await i.playTurn(),l.nextTurn()},1e3)}});const h=document.getElementById("btn-plates"),a=document.getElementById("plates-modal"),c=document.getElementById("plates-list");h&&h.addEventListener("click",()=>{a.style.display="flex",d(l)}),a.addEventListener("click",o=>{o.target===a&&(a.style.display="none")});function d(o){c.innerHTML="",o.plates.forEach(y=>{const p=document.createElement("div");p.className="plate-card",p.innerHTML=`
                <div class="plate-name">${y.name}</div>
                <div class="plate-desc">${y.desc}</div>
                <div style="font-size: 1.5rem; text-align: center;">âš¡</div>
            `,p.onclick=()=>{console.log(`Using Plate: ${y.name}`),a.style.display="none"},c.appendChild(p)})}function u(o){const y=document.getElementById("bench-slots");y&&(y.innerHTML="",o.playerBench.forEach((p,b)=>{const m=document.createElement("div");m.className="bench-slot",m.innerHTML="ðŸ‘¾",m.title=p.name,m.onclick=()=>{if(o.currentPlayer!=="player")return;const g=Math.random()>.5?0:1;e.units.has(g)?alert("Portal de Entrada bloqueado!"):(e.placeUnit(p,g),o.playerBench.splice(b,1),u(o))},y.appendChild(m)}))}});
